<section
    id="homemade-indulgence"
    class="p-4 mt-10 flex flex-col"
  >
    <h1 class="font-primary">Live Menu</h1>

    <div class="flex justify-evenly">
        <div class="flex flex-col w-4/5 md:w-3/5">
            <div *ngFor="let category of menuItemCategories; let index = index;">
                <button (click)="toggleAccordion(index)" class="bg-vanilla text-primary text-xl w-full flex justify-between items-center p-2 font-semibold border-b border-secondary">
                  <span>{{category}}</span>
                  <span id="icon-1" class="text-slate-800 transition-transform duration-300">
                    <span *ngIf="accordionStates[index] === 'collapsed'">
                        <svg class="w-6 h-6 fill-primary">
                            <use xlink:href="assets/sprite-sheet.svg#expand"></use>
                        </svg>
                    </span>
                    <span *ngIf="accordionStates[index] === 'expanded'">
                        <svg class="w-6 h-6 fill-primary">
                            <use xlink:href="assets/sprite-sheet.svg#collapse"></use>
                        </svg>
                    </span>
                  </span>
                </button>
                <div [@accordionState]="accordionStates[index]" class="my-2 flex flex-col gap-4">
                    <div *ngFor="let menuItem of menuItems | productFilter : 'category' : category" class="flex w-full bg-secondary/5">
                        <div class="flex w-4/5">
                            <img src="assets/media/bakery-products/{{menuItem.imageFileName}}" alt="" class="h-24 w-auto">
            
                            <div class="flex flex-col gap-1 p-2 w-full">
                                <div class="flex flex-col grow font-primary">
                                    <div class="font-semibold text-lg">{{menuItem.name}}</div>
                                    <div class="text-xs">{{menuItem.description}}</div>
                                </div>
                
                                <div class="flex flex-col ml-4 font-monospace gap-y-2">
                                    <div *ngFor="let variant of menuItem.variants" class="flex justify-between items-center">
                                        <div class="text-sm">{{variant.name}}</div>
                                        <div class="font-semibold">{{variant.price | number: "1.2-2"}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                        <div class="border-l border-dashed flex flex-col gap-1 p-2 w-1/5 min-w-fit justify-end">
                            <div class="flex flex-col font-monospace gap-y-2 items-center">
                                <div *ngFor="let variant of menuItem.variants;" class="flex justify-center items-center w-full">
                                    <ng-container *ngIf="getQuantity(variant.skuID) > 0; else AddToCart">
                                        <button
                                            (click)="decreaseQuantity(variant.skuID)"
                                            class="bg-secondary/15 font-semibold min-w-8 rounded-sm flex justify-center items-center disabled:pointer-events-none disabled:opacity-25"
                                            [disabled]="isQuantityMinimum(variant.skuID)"
                                        >
                                            <svg class="w-6 h-6 fill-secondary">
                                                <use xlink:href="assets/sprite-sheet.svg#subtract"></use>
                                            </svg>
                                        </button>
                                        <input
                                            type="number" readonly
                                            [value]="getQuantity(variant.skuID)"
                                            class="w-10 text-center outline-none ring-0"
                                        >
                                        <button
                                            (click)="increaseQuantity(menuItem, variant)"
                                            class="bg-secondary/15 font-semibold min-w-8 rounded-sm flex justify-center items-center disabled:pointer-events-none disabled:opacity-25"
                                            [disabled]="isQuantityMaximum(variant)"
                                        >
                                            <svg class="w-6 h-6 fill-secondary">
                                                <use xlink:href="assets/sprite-sheet.svg#add"></use>
                                            </svg>
                                        </button>
                                    </ng-container>

                                    <ng-template #AddToCart>
                                        <button (click)="increaseQuantity(menuItem, variant)" class="bg-secondary text-center text-neutral w-4/5 rounded-sm">Add</button>
                                    </ng-template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="flex flex-col w-4/5 md:w-1/3 bg-primary/5 rounded-md p-4 gap-y-4 h-max sticky top-[7.5rem]">
            <h2 class="font-secondary">Your Cart</h2>

            <div class="flex flex-col text-sm bg-neutral p-2">
                <div class="font-semibold">Note</div>
                <ul class="list-inside list-disc">
                    <li>All orders must be placed at least 24 hours in advance.</li>
                    <li>Delivery charges are applicable extra, per actuals.</li>
                </ul>
            </div>

            <div
                *ngIf="cartItems.length > 0"
                (click)="emptyCartModalState = 'visible'"
                class="self-end text-sm underline decoration-dotted cursor-pointer"
            >
                Empty Cart
            </div>

            <div class="flex flex-col gap-y-4">
                <ng-container *ngIf="cartItems.length; else EmptyCart">
                    <div *ngFor="let item of cartItems">
                        <div class="text-xs uppercase">{{item.category}}</div>
                        <div class="flex justify-between font-semibold text-secondary">
                            <div>{{item.name}}</div>
                            <div class="font-monospace">{{item.orderCost | number : "1.2-2"}}</div>
                        </div>
                        <div class="flex text-sm font-monospace justify-between">
                            <div class="w-1/3">{{item.variantName}}</div>
                            <div class="w-1/3 text-right">x {{item.orderQuantity}}</div>
                        </div>
                    </div>
                </ng-container>

                <ng-template #EmptyCart>
                    <div class="text-center italic">None here yet. Add some indulgences to treat yourself!</div>
                </ng-template>
            </div>

            <div class="flex justify-between font-semibold border-t border-dashed pt-4">
                <div>Cart Total</div>
                <div class="font-monospace">{{getCartValue() | number : "1.2-2"}}</div>
            </div>

            <button
                (click)="placeOrder()"
                class="w-full flex bg-primary text-neutral rounded-lg px-2 py-1 items-center justify-center disabled:opacity-25 disabled:pointer-events-none disabled:cursor-not-allowed"
                [disabled]="cartItems.length === 0"
            >
                <svg class="w-5 h-5 fill-neutral">
                    <use xlink:href="assets/sprite-sheet.svg#social-whatsapp"></use>
                </svg>
                <span class="ml-2">Place Order via WhatsApp</span>
            </button>
        </div>
    </div>
</section>

<ng-container *ngIf="emptyCartModalState === 'visible'">
    <div
        (click)="hideEmptyCartModal($event)"
        class="relative z-10"
        aria-labelledby="empty-cart-modal"
        role="dialog"
        aria-modal="true"
    >
        <div
            class="fixed inset-0 bg-primary bg-opacity-35"
        ></div>

        <div class="fixed inset-0 z-20 w-screen overflow-y-auto">
            <div
                class="flex min-h-full items-center justify-center p-4"
                id="empty-cart-modal-background"
            >
                <div class="relative transform overflow-hidden rounded-lg bg-neutral text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-xl"
                >
                    <div class="bg-primary/10 px-4 py-2 font-semibold">
                        Confirm Action
                    </div>
                    <div class="bg-neutral p-4 flex flex-col">
                        Are you sure you want to clear the items in your cart? This cannot be undone. However, you can add any items to cart again.
                    </div>
                    <div
                        class="bg-secondary bg-opacity-15 px-4 py-3 sm:flex sm:flex-row-reverse sm:items-center"
                    >
                        <button
                            (click)="emptyCart()"
                            type="button"
                            class="inline-flex flex-col w-full justify-center items-center rounded-md border-2 border-primary bg-primary px-2 py-1 font-semibold text-neutral sm:ml-3 sm:w-auto"
                        >
                            Yes, Empty Cart
                        </button>
                        <button
                            id="empty-cart-modal-cancel"
                            type="button"
                            class="mt-3 inline-flex w-full justify-center rounded-md px-3 py-2 text-sm font-semibold sm:mt-0 sm:w-auto"
                        >
                            No, Go Back
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-container>